\section{Implementation of NFC}
We have created a class called \lstinline|NfcForegroundActivity| which every activity that we want to enable \ac{nfc} on can extend. \lstinline|NfcForegroundActivity| contains some useful methods to aid in the use of the \ac{nfc} tags.

\subsection{Foreground Mode}
\label{sec:foeground}

It is possible to force priority over other activities when handling \ac{nfc} intents using the Foregroud Dispatch System \citep{foregroundDispatch}. This enables us to handle the intent when the user has out activity open and scans an \ac{nfc} tag.

\begin{lstlisting}[language=java, label=nfcForegroundOnCreate, caption=OnCreate]
public NfcForeground(Context context) { 
  this.nfcAdapter = NfcAdapter.getDefaultAdapter(this.context);
  this.nfcPendingIntent = PendingIntent.getActivity(this.context, 0, new Intent(this.context, ((Activity) this.context).getClass()).addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP), 0);
}
\end{lstlisting}\todo{fix caption}
\begin{description}
\item[Line 2] The default \ac{nfc} adapter is get and saved.
\item[Line 3] A pending intent is created and saved for later use.
\end{description}\todo{Description skal m√•ske uddybes}
As seen in \autoref{nfcForegroundOnCreate} a pending intent is set. This is necessary because the system must have an intent to populate when an \ac{nfc} tag is scanned.

\begin{lstlisting}[language=java, caption=Foreground mode enabling]
protected void onResume() {
  // foreground mode gives the current active application priority for reading scanned tags
  IntentFilter tagDetected = new IntentFilter(NfcAdapter.ACTION_TAG_DISCOVERED); // filter for tags
  IntentFilter[] writeTagFilters = new IntentFilter[] { tagDetected };
  this.nfcAdapter.enableForegroundDispatch((Activity) this.context, this.nfcPendingIntent, writeTagFilters, null);
}
\end{lstlisting}




NDEF Tools for Android \citep{ndeftools}